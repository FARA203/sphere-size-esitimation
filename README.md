# 視覚的に同等な大きさのポリープ（球体）の直接推定・識別AIモデル

本プロジェクトでは、**視覚的に同じ大きさに見える異なるサイズのポリープ（球体）**（例：3mmと5mm）を正確に分類・推定するための**ニューラルネットワークモデル**を提案します。

---

## 🧑‍⚕️ 背景と目的

- 大腸の**腫瘍性ポリープ**は、放置すると**癌化のリスク**があります。
- ポリープの大きさは、これまで**内視鏡医の主観的判断**に依存していました。
- **奥行き（Z座標）や照明条件**によって、**異なるサイズのポリープが視覚的に同じ大きさに見える**ことがあります。
- そのため、**客観的かつ自動でサイズを分類・推定するAI**の導入が求められています。

---

## 💡 提案手法

### STEP 1: 合成データセットの作成

- 3mmおよび5mmの球体をポリープに見立て、**光源位置**と**奥行き**を変えて画像を生成。
- 人間には**同じサイズに見える条件**を意図的に作成。

### STEP 2: モデル学習

- 明るさの変化を手がかりに、以下の2タスクを学習：
  - **分類**：3mm vs 5mm（2クラス）
  - **回帰**：サイズ（mm）を直接推定

---

## 🗂 データセット構成

| 項目         | 内容                            |
|--------------|---------------------------------|
| サンプル数   | 各サイズ 100 画像               |
| 光源位置     | `[-100.0, 100.0]` ランダム配置   |
| Z座標（3mm） | `[90.0 ~ 190.0]` mm             |
| Z座標（5mm） | `[150.0 ~ 320.0]` mm            |

---

## ⚙️ データ前処理

1. 入力画像を `224×224×3` にリサイズ  
2. PyTorchテンソル形式 `3×224×224` に変換し、ピクセル値を `[0, 1]` に正規化  
3. 各チャンネルごとに標準化：  
   - 平均：`[0.485, 0.456, 0.406]`  
   - 標準偏差：`[0.229, 0.224, 0.225]`  
4. 最終層の出力ユニットを変更：  
   - 分類：`2`  
   - 回帰：`1`

---

## 🧪 実験設定

- 使用モデル：`ResNet-18`, `DenseNet-121`, `EfficientNet-B0`, `ViT-Base-B32`
- オプティマイザ：Adam  
- バッチサイズ：32  
- エポック数：100  
- 学習率：
  - 通常：`1e-3`  
  - ViT：`1e-4`  
- 損失関数：
  - 分類：`CrossEntropyLoss`  
  - 回帰：`MSELoss`

---

## 📊 結果

### 🔸 分類（3mm vs 5mm）

| モデル         | Accuracy | Precision | Recall | F1スコア |
|----------------|----------|-----------|--------|---------|
| ResNet         | 0.9700   | 0.9717    | 0.9700 | 0.9700  |
| DenseNet       | 0.9850   | 0.9854    | 0.9850 | 0.9850  |
| EfficientNet   | 0.9950   | 0.9950    | 0.9950 | 0.9950  |
| ViT            | 1.0000   | 1.0000    | 1.0000 | 1.0000  |

### 🔹 回帰（サイズを直接推定）

| モデル         | MAE     | MSE     | RMSE    | R²     |
|----------------|---------|---------|---------|--------|
| ResNet         | 0.2948  | 0.1613  | 0.4017  | 0.8387 |
| DenseNet       | 0.2543  | 0.1136  | 0.3371  | 0.8864 |
| EfficientNet   | 0.6300  | 0.6026  | 0.7763  | 0.3974 |
| ViT            | 0.3267  | 0.1658  | 0.4072  | 0.8342 |

### 可視化
![winf](https://github.com/user-attachments/assets/919a4871-953e-4396-af8b-e1c9590ba8ee)

---

## 🔚 まとめと今後の展望

- 人間の目には**同じ大きさに見える**球体画像を用いて、AIが**奥行きと照明の違いによる明るさの変化**を学習。
- **ViTは分類タスクで最高性能**、**DenseNetは回帰タスクで最良の性能**を発揮。
- 今後は、**実際のポリープ画像**を用いたモデルの精度検証と改良を目指す。

---
